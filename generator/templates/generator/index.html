{% extends "generator/base.html" %}
{% load i18n %}

{% block title %}Read My Mood | {{ site_title|default:_('MoodReader') }}{% endblock %}

{% block content %}
    <section class="mrg-section--about">
        <h2>What's MoodReader?</h2>
        <p>MoodReader is a mood ring but for your word. Type in how your feeling, what your thinking of, or even your
            latest tweet to get a generated color gradient of your word mood.</p>
    </section>

    <section class="mrg-section--try">
        <h2>Try it out now!</h2>
        {% if error_message %}
            <div class="alert alert-warning" role="alert"><strong>Warning!</strong> {{ error_message }}</div>
        {% endif %}
        <form class="container">
            {% csrf_token %}
          <div class="form-group">
            <label for="mood-title">Mood Title</label>
            <input required class="form-control" placeholder="Enter a title" id="entry_title" name="entry_title">
          </div>
          <div class="form-group">
            <label for="mood-entry">Enter in a few words below to see what color your words will turn.</label>
            <textarea required  class="form-control" placeholder="Enter 10 words or more so we can know how your feeling" id="entry" name="entry" rows="3"></textarea>
          </div>
            <input type="hidden" name="gradient_color_stop_1">
            <input type="hidden" name="gradient_color_stop_2">
            <input type="hidden" name="gradient_color_stop_3">
            <input type="hidden" name="pub_date">
            <button id="btn--send-mood" type="button" disabled class="btn btn-warning float-right"><b>Generate Mood</b></button>
    </section>
    <script
            src="https://code.jquery.com/jquery-3.3.1.min.js"
            integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
            crossorigin="anonymous"></script>
    <script>
    var btn = $('#btn--send-mood');
        $(document).ready(function () {
            var moodEntry = $('#entry');


            moodEntry.on('keyup',function () {
                let wordCount = $(this).val().match(/\S+/g);
                let currentValueLength = wordCount ? wordCount.length : 0;

                if(currentValueLength <= 10){
                    console.log('enter more words');
                    btn.prop('disabled', true);
                }else {
                    console.log('entered enough');
                    btn.prop('disabled', false);
                }

            });

        });
        function postMoodEntry(){
            let formData = $('form').serialize();
            $.post('http://localhost:8000/api',formData).done(function (data) {
                console.log(data)
            }).fail(function (data) {
                console.log(data.status);
                console.log(data.responseText);
            })
        }
        btn.on('click', function(){
            postMoodEntry();
        })

    </script>
{% endblock %}
